<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.phxl.ysy.dao.UserOperationMapper">

	<resultMap id="BaseResultMap"
		type="com.phxl.ysy.entity.UserOperation">
		<id column="OPERATION_GUID" property="operationGuid" jdbcType="VARCHAR" />
		<result column="ERROR_REASON" property="errorReason" jdbcType="VARCHAR" />
		<result column="MODULE_ID" property="moduleId" jdbcType="VARCHAR" />
		<result column="OPERATION_DATE" property="operationDate"
			jdbcType="DATE" />
		<result column="OPERATION_URL" property="operationUrl"
			jdbcType="VARCHAR" />
		<result column="OPERATION_NAME" property="operationName"
			jdbcType="VARCHAR" />
		<result column="OPERATION_RES" property="operationRes"
			jdbcType="VARCHAR" />
		<result column="OPERATION_CODE" property="operationCode"
			jdbcType="VARCHAR" />
		<result column="OPERATION_ARGS" property="operationArgs"
			jdbcType="VARCHAR" />
		<result column="LOGIN_GUID" property="loginGuid" jdbcType="VARCHAR" />
		<result column="MODULE_NAME" property="moduleName" jdbcType="VARCHAR" />
	</resultMap>

	<sql id="Base_Column_List">
		OPERATION_GUID, ERROR_REASON, MODULE_ID, OPERATION_DATE,
		OPERATION_URL, OPERATION_NAME,
		OPERATION_RES, OPERATION_CODE,
		LOGIN_GUID, MODULE_NAME
	</sql>

	<sql id="return_Column_List">
		OPERATION_GUID "operationGuid", ERROR_REASON "errorReason",MODULE_ID "moduleId", OPERATION_DATE "operationDate", OPERATION_NAME "operationName",
		OPERATION_RES "operationRes", OPERATION_CODE "operationCode", MODULE_NAME "moduleName",
		OPERATION_ARGS "operationArgs", LOGIN_USERNO "loginUserno", LOGIN_USERNAME "loginUsername", LOGIN_BROWSER "loginBrowser",
		ORG_NAME "orgName", LOGIN_IP "loginIp", LOGIN_OS "loginOs"
	</sql>

	<!-- 查询操作记录的列表 -->
	<select id="searchOpRecords" resultType="hashMap"
		parameterType="com.phxl.core.base.entity.Pager">
		SELECT <include refid="return_Column_List" />
		from ts_user_operation uop,ts_user_login ul
		where uop.LOGIN_GUID = ul.LOGIN_GUID
		<if test="conditiions!=null and !conditiions.empty">
				<if test="conditiions.userName!=null and conditiions.userName!=''">
					and regexp_like(ul.LOGIN_USERNAME, #{conditiions.userName, jdbcType=VARCHAR})
				</if>
				<if test="conditiions.orgName!=null and conditiions.orgName!=''">
					and regexp_like(ul.ORG_NAME, #{conditiions.orgName, jdbcType=VARCHAR})
				</if>
				<if test="conditiions.moduleId!=null and conditiions.moduleId!='-1'">
					and uop.MODULE_NAME = #{conditiions.moduleId, jdbcType=VARCHAR}
				</if>
				<if test="conditiions.opName!=null and conditiions.opName!=''">
					and regexp_like(uop.OPERATION_NAME, #{conditiions.opName, jdbcType=VARCHAR})
				</if>
				<if test="conditiions.startTime!=null and conditiions.startTime!=''">
					 <![CDATA[ 
					and to_char(uop.OPERATION_DATE,'yyyy-mm-dd') >= #{conditiions.startTime} ]]>
				</if>
				<if test="conditiions.endTime!=null and conditiions.endTime!=''">
					 <![CDATA[ 
					and to_char(uop.OPERATION_DATE,'yyyy-mm-dd') <= #{conditiions.endTime} ]]>
				</if>
		</if>
		order by OPERATION_DATE desc
	</select>
</mapper>