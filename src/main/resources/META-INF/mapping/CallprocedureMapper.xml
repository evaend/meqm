<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.phxl.ysy.dao.CallprocedureMapper">

	<resultMap id="BillResultMap" type="java.util.Map">
		<result column="ret" property="flag" jdbcType="VARCHAR"/>
		<result column="fno" property="billNo" jdbcType="VARCHAR"/>
		<result column="error" property="error" jdbcType="VARCHAR"/>
	</resultMap>
	
	<!-- 获取单号 -->
	<select id="SP_GET_BILL_NOSTORAGE" parameterType="map" statementType="CALLABLE">
		{ call sp_get_bill_nostorage(
			#{billOrgId, jdbcType=NUMERIC, mode=IN},
			#{asLen, jdbcType=NUMERIC, mode=IN},
			#{billName, jdbcType=VARCHAR, mode=IN},
			#{billPrefix, jdbcType=VARCHAR, mode=IN},
			#{cursor, jdbcType=CURSOR, javaType=ResultSet, mode=OUT, resultMap=BillResultMap}
		  )
		}
	</select>
	
	<!-- 获取二维码单号 -->
	<select id="SP_GET_QRBILL" parameterType="map" statementType="CALLABLE">
		{ call sp_get_qrbill(
			#{billOrgId, jdbcType=NUMERIC, mode=IN},
			#{billPrefix, jdbcType=VARCHAR, mode=IN},
			#{cursor, jdbcType=CURSOR, javaType=ResultSet, mode=OUT, resultMap=BillResultMap}
		  )
		}
	</select>
	
	<resultMap id="OutResultMap" type="java.util.Map">
  	  <result column="ret" jdbcType="VARCHAR" property="flag" />
  	  <result column="fvalue" jdbcType="VARCHAR" property="fvalue" />
  	  <result column="error" jdbcType="VARCHAR" property="error" />
    </resultMap>
	
	<!-- 库存盘点 -->
  <select id="SP_PD_COUNT" parameterType="map" statementType="CALLABLE">
  	{CALL SP_PD_COUNT(
  		#{userid, jdbcType=VARCHAR, mode=IN},
  		#{storage_id, jdbcType=VARCHAR, mode=IN},
  		#{org_id, jdbcType=NUMERIC, mode=IN},
  		#{remark, jdbcType=VARCHAR, mode=IN},
  		#{asLen, jdbcType=NUMERIC, mode=IN},
  		#{billName, jdbcType=VARCHAR, mode=IN},
  		#{billPrefix, jdbcType=VARCHAR, mode=IN},
  		#{cursor, jdbcType=CURSOR, javaType=ResultSet, mode=OUT, resultMap=OutResultMap}
  	)}
  </select>

</mapper>