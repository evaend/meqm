<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.phxl.ysy.dao.TreatmentOperMapper">

	<resultMap id="BaseResultExtMap" type="com.phxl.ysy.dto.PatientOperDto">
		<id column="OPER_RECORD_GUID" property="operRecordGuid" jdbcType="VARCHAR"/>
		<result column="OPER_NAME" property="operName" jdbcType="VARCHAR"/>
		<result column="OPER_DOCTOR" property="operDoctor" jdbcType="VARCHAR"/>
		<result column="OPER_ROOM" property="operRoom" jdbcType="VARCHAR"/>
		<result column="CIRCUIT_NURSE" property="circuitNurse" jdbcType="VARCHAR"/>
		<result column="BED_NUM" property="bedNum" jdbcType="VARCHAR"/>
		<result column="OPER_EXPLAIN" property="operExplain" jdbcType="VARCHAR"/>
		<result column="OPER_NO" property="operNo" jdbcType="VARCHAR"/>
		<result column="OPER_BM" property="operBm" jdbcType="VARCHAR"/>
		<result column="OPER_DATE" property="operDate" jdbcType="TIMESTAMP"/>
		<result column="MZFF" property="mzff" jdbcType="VARCHAR"/>
		<result column="DYZS" property="dyzs" jdbcType="VARCHAR"/>
		<result column="DEZS" property="dezs" jdbcType="VARCHAR"/>
		<result column="MZYS" property="mzys" jdbcType="VARCHAR"/>
		<result column="FDATE" property="fdate" jdbcType="TIMESTAMP"/>
		<result column="TREATMENT_RECORD_GUID" property="treatmentRecordGuid" jdbcType="VARCHAR"/>
		<result column="PATIENT_FSOURCE" property="patientFsource" jdbcType="DECIMAL"/>
		<result column="ZX_DEPT_GUID" property="zxDeptGuid" jdbcType="VARCHAR"/>
		<result column="TF_REMARK" property="tfRemark" jdbcType="VARCHAR"/>
		<result column="TREATMENT_NO" property="treatmentNo" jdbcType="VARCHAR" />
		<result column="NAME" property="name" jdbcType="VARCHAR" />
		<result column="GENDER" property="gender" jdbcType="VARCHAR" />
		<result column="AGE" property="age" jdbcType="DECIMAL" />
		<result column="R_ORG_ID" property="rOrgId" jdbcType="VARCHAR" />
		<result column="PATIENTID" property="patientid" jdbcType="VARCHAR" />
		<result column="VISITID" property="visitid" jdbcType="VARCHAR" />
		<result column="ZYH" property="zyh" jdbcType="VARCHAR" />
		<result column="BIRTH_DATE" property="birthDate" jdbcType="TIMESTAMP" />
		<result column="SFZH" property="sfzh" jdbcType="VARCHAR" />
		<result column="LXR" property="lxr" jdbcType="VARCHAR" />
		<result column="LXDH" property="lxdh" jdbcType="VARCHAR" />
		<result column="LXADD" property="lxadd" jdbcType="VARCHAR" />
		<result column="DEPT_GUID" property="deptGuid" jdbcType="VARCHAR" />
		<result column="DEPT_NAME" property="deptName" jdbcType="VARCHAR" />
		<result column="BED_NO" property="bedNo" jdbcType="VARCHAR" />
		<result column="ZYRQ" property="zyrq" jdbcType="TIMESTAMP" />
	</resultMap>

	<sql id="Base_Column_List_With_Prefix">
		tor.OPER_RECORD_GUID, tor.OPER_NAME, tor.OPER_DOCTOR, tor.OPER_ROOM, tor.CIRCUIT_NURSE, tor.BED_NUM,
		tor.OPER_EXPLAIN, tor.OPER_NO, tor.OPER_BM, tor.OPER_DATE, tor.MZFF, tor.DYZS, tor.DEZS, tor.MZYS, tor.FDATE,
		tor.PATIENT_FSOURCE, tor.ZX_DEPT_GUID, tor.TF_REMARK, tor.TREATMENT_RECORD_GUID
	</sql>

	<sql id="TREATMENT_RECORD_Column_List_With_Prefix">
		ttr.TREATMENT_NO, ttr.NAME, ttr.GENDER, ttr.AGE, ttr.R_ORG_ID, ttr.PATIENTID, ttr.VISITID,
		ttr.ZYH, ttr.BIRTH_DATE, ttr.SFZH, ttr.LXR, ttr.LXDH, ttr.LXADD, ttr.DEPT_GUID, ttr.DEPT_NAME, ttr.BED_NO, ttr.ZYRQ
	</sql>
	
	<!-- 查询指定患者手术信息 -->
	<select id="findPatientOperInfo" resultMap="BaseResultExtMap" parameterType="string">
		SELECT
			<include refid="Base_Column_List_With_Prefix"/>,
			<include refid="TREATMENT_RECORD_Column_List_With_Prefix"/>
		from TB_OPER_RECORD tor
		LEFT JOIN TB_TREATMENT_RECORD ttr on tor.TREATMENT_RECORD_GUID=ttr.TREATMENT_RECORD_GUID
		WHERE tor.OPER_RECORD_GUID = #{operRecordGuid, jdbcType=VARCHAR}
	</select>

	<!-- 根据申请单id，查询关联的患者手术信息 -->
	<select id="findPatientOperByApplyId" resultMap="BaseResultExtMap" parameterType="string">
		SELECT
			<include refid="Base_Column_List_With_Prefix"/>,
			<include refid="TREATMENT_RECORD_Column_List_With_Prefix"/>
		from TB_OPER_RECORD tor
		LEFT JOIN TB_TREATMENT_RECORD ttr on tor.TREATMENT_RECORD_GUID=ttr.TREATMENT_RECORD_GUID
		JOIN TB_APPLY a on tor.OPER_RECORD_GUID=a.OPER_RECORD_GUID
		WHERE a.apply_id = #{applyId, jdbcType=VARCHAR}
	</select>

</mapper>